<!DOCTYPE html>
<html>
<head>
    <title>Real Shopify Product AI Generation</title>
    <style>
        body { font-family: Arial; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .section { border: 1px solid #ddd; margin: 20px 0; padding: 20px; border-radius: 8px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a87; }
        button.apply { background: #28a745; }
        button.apply:hover { background: #218838; }
        .result { margin-top: 15px; padding: 15px; border-radius: 4px; }
        .success { background: #f0f8f0; border: 1px solid #4caf50; }
        .error { background: #f8f0f0; border: 1px solid #f44336; }
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .product-item { border: 1px solid #eee; padding: 15px; border-radius: 8px; }
        .generated-content { background: #f9f9f9; padding: 15px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üõçÔ∏è Real Shopify Product AI Generator</h1>
    
    <!-- Store Connection -->
    <div class="section">
        <h2>Store Connection</h2>
        <div class="form-group">
            <label>Shop Domain:</label>
            <input type="text" id="shopDomain" value="ashcoding.myshopify.com">
        </div>
        <div class="form-group">
            <label>Access Token:</label>
            <input type="password" id="accessToken" placeholder="Your access token">
        </div>
        <button onclick="loadProducts()">Load Products</button>
        <div id="connectionResult" class="result"></div>
    </div>

    <!-- Product Selection -->
    <div class="section">
        <h2>Select Product for AI Description</h2>
        <div id="productList"></div>
    </div>

    <!-- Generation Results -->
    <div class="section">
        <h2>Generated Content</h2>
        <div id="generationResult"></div>
    </div>

    <script>
        let currentProducts = [];
        let currentGeneration = null;

        async function loadProducts() {
            const resultDiv = document.getElementById('connectionResult');
            const productListDiv = document.getElementById('productList');
            
            resultDiv.innerHTML = '<div style="color: #666;">Loading products...</div>';
            
            const shopDomain = document.getElementById('shopDomain').value;
            const accessToken = document.getElementById('accessToken').value;
            
            try {
                const response = await fetch('/api/test-shopify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ shopDomain, accessToken })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `‚úÖ Connected! Found ${data.productCount} products`;
                    
                    // Show products for selection
                    productListDiv.innerHTML = `
                        <h3>Your Products:</h3>
                        ${data.sampleProducts.map(product => `
                            <div class="product-item">
                                <h4>${product.title}</h4>
                                <p>Price: $${product.price}</p>
                                <p>Status: ${product.hasDescription ? '‚úÖ Has description' : '‚ùå Needs description'}</p>
                                <button onclick="generateForProduct('${product.id}', '${product.title}')">
                                    Generate AI Description
                                </button>
                            </div>
                        `).join('')}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Error: ${data.error}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        async function generateForProduct(productId, productTitle) {
            const resultDiv = document.getElementById('generationResult');
            resultDiv.innerHTML = '<div style="color: #666;">ü§ñ Generating AI description...</div>';
            
            const shopDomain = document.getElementById('shopDomain').value;
            const accessToken = document.getElementById('accessToken').value;
            
            try {
                const response = await fetch('/api/generate-shopify-product', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        shopDomain, 
                        accessToken, 
                        productId, 
                        tone: 'professional' 
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentGeneration = data;
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>‚úÖ Generated for: ${data.product.title}</h3>
                        <p><strong>Tokens Used:</strong> ${data.tokensUsed}</p>
                        <p><strong>Content ID:</strong> ${data.contentId}</p>
                        
                        <h4>Original Description:</h4>
                        <div class="generated-content">
                            ${data.product.originalDescription || '<em>No original description</em>'}
                        </div>
                        
                        <h4>ü§ñ AI Generated Description:</h4>
                        <div class="generated-content">
                            ${data.generatedDescription}
                        </div>
                        
                        <button class="apply" onclick="applyToShopify('${productId}')">
                            Apply This Description to Shopify Store
                        </button>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Error: ${data.error}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        async function applyToShopify(productId) {
            if (!currentGeneration) return;
            
            const shopDomain = document.getElementById('shopDomain').value;
            const accessToken = document.getElementById('accessToken').value;
            
            try {
                const response = await fetch('/api/apply-to-shopify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        shopDomain, 
                        accessToken, 
                        productId, 
                        description: currentGeneration.generatedDescription 
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Description applied to your Shopify store successfully!');
                } else {
                    alert('‚ùå Error applying to Shopify: ' + data.error);
                }
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            }
        }
    </script>
</body>
</html>